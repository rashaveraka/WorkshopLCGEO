<!-- ====================================================================== -->
<!--                                                                        -->
<!--    XML description of the CLIC NDM ECal EndCaps                        -->
<!--                                                                        -->
<!--    Contained are the required                                          -->
<!--      ++ envelope definition                                            -->
<!--      ++ global constants used uniquely by this module                  -->
<!--      ++ visualization attributes                                       -->
<!--      ++ the definition of the readout structure and the                -->
<!--         readout segmentation                                           -->
<!--      ++ the include statements for the sensitive detectors and         -->
<!--         the corresponding support structure(s)                         -->
<!--                                                                        -->
<!--                                                                        -->
<!--   @author  D.Protopopescu                                              -->
<!--   @date    13/05/2015                                                  -->
<!--   Envelope-enabled version based on the CLIC_o1_v00 version            -->
<!--                                                                        -->
<!-- ====================================================================== -->

<lccdd>
    
    <!--  Definition of the readout segmentation/definition  -->
    <readouts>
        <readout name="ECalEndcapHits">
            <segmentation type="CartesianGridXY" grid_size_x="5.1" grid_size_y="5.1" />
            <id>system:8,barrel:-2,sector:4,tower:3,layer:6,slice:5,x:32:-16,y:-16</id>
            <!-- Marcus says 8 for ‘system’, Frank says 5 is enough -->        
        </readout>
    </readouts>
    
    <!--  Definition of the used visualization attributes    -->
    <display>
        <vis name="EcalSectorVis"      alpha="1.0" r="0.0"  g="0.8"  b="1.0"  showDaughters="true"  visible="true"/>
    </display>

    <detectors>        
        <detector name="ECalEndcap" type="ECalEndcap_o1_v01" id="DetID_ECal_Endcap" readout="ECalEndcapHits" vis="ECALVis">
            
            <comment>EM Calorimeter EndCap</comment>
            
            <envelope vis="ECALVis">
                <shape type="BooleanShape" operation="Subtraction" material="Air">
                    <shape type="BooleanShape" operation="Subtraction">
                        <shape type="PolyhedraRegular"  numsides="ECalEndcap_outer_symmetry" rmin="0" rmax="ECalEndcap_outer_radius*cos(pi/ECalEndcap_outer_symmetry)" dz="2.0*ECalEndcap_max_z"/>
                        <shape type="PolyhedraRegular"  numsides="ECalEndcap_outer_symmetry" rmin="0" rmax="ECalEndcap_outer_radius" dz="2.0*ECalEndcap_min_z"/>
                    </shape>
                    <shape type="Box" dx="ECalEndcap_inner_radius" dy="ECalEndcap_inner_radius" dz="ECalEndcap_max_z + 2.0*env_safety"/>
                    <rotation x="0*deg" y="0*deg" z="180*deg/ECalEndcap_outer_symmetry"/>
                </shape>
                <rotation x="0*deg" y="0*deg" z="90*deg-180*deg/ECalEndcap_outer_symmetry"/>
            </envelope>
            
            <parameter ecal_endcap_tolerance="env_safety" FaceThickness="1.60*mm" RadiatorMaterial="TungstenDens24" />
	    <dimensions numsides="ECalEndcap_outer_symmetry" rmin="ECalEndcap_inner_radius" rmax="ECalEndcap_outer_radius" zmin="ECalEndcap_min_z" zmax="ECalEndcap_max_z"/>

            <staves vis="EcalSectorVis" />
	      <layer repeat="1" vis="EcalLayerVis" thickness="3.65*mm">
                <slice material = "Air"            thickness = "0.25*mm" vis="InvisibleNoDaughters"/>
		<slice material = "siPCBMix"       thickness = "1.20*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.10*mm" vis="InvisibleNoDaughters"/><!-- glue -->
                <slice material = "Silicon"        thickness = "0.50*mm" sensitive="yes" limits="cal_limits" vis="EcalSensitiveVis"/>
                <slice material = "GroundOrHVMix"  thickness = "0.10*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.15*cm" vis="InvisibleNoDaughters"/><!-- fiber -->
              </layer>
              <layer repeat="17" vis="EcalLayerVis" thickness="17*3.40*mm">
                <slice material = "TungstenDens24" thickness = "1.00*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.25*mm" vis="InvisibleNoDaughters"/><!-- fiber -->
                <slice material = "GroundOrHVMix"  thickness = "0.10*mm" vis="EcalAbsorberVis"/>
                <slice material = "Silicon"        thickness = "0.50*mm" sensitive="yes" limits="cal_limits" vis="EcalSensitiveVis"/>
                <slice material = "Air"            thickness = "0.10*mm" vis="InvisibleNoDaughters"/><!-- glue -->
                <slice material = "siPCBMix"       thickness = "1.20*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.25*mm" vis="InvisibleNoDaughters"/>
            </layer>
            <layer repeat="8" vis="EcalLayerVis" thickness="8*3.60*mm">
                <slice material = "TungstenDens24" thickness = "1.20*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.25*mm" vis="InvisibleNoDaughters"/><!-- fiber -->
                <slice material = "GroundOrHVMix"  thickness = "0.10*mm" vis="EcalAbsorberVis"/>
                <slice material = "Silicon"        thickness = "0.50*mm" sensitive="yes" limits="cal_limits" vis="EcalSensitiveVis"/>
                <slice material = "Air"            thickness = "0.10*mm" vis="InvisibleNoDaughters"/><!-- glue -->
                <slice material = "siPCBMix"       thickness = "1.20*mm" vis="EcalAbsorberVis"/>
                <slice material = "Air"            thickness = "0.25*mm" vis="InvisibleNoDaughters"/>
            </layer>
            <layer repeat="1" vis="EcalLayerVis" thickness="1.20*mm">
                <slice material = "TungstenDens24" thickness = "1.20*mm" vis="EcalAbsorberVis"/>
            </layer>

        </detector>
        
    </detectors>
    
</lccdd>


